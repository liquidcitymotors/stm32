#include "stm32f3xx_hal.h"
#include "stm32f3xx.h"
#include "stm32f3xx_it.h"



// wavetable size - 1 in fix16 and that number doubled
uint32_t span;
uint32_t spanx2;
int tableSizeCompensation;

//per family bit shift amounts to accomplish morph
uint32_t morphBitShiftRight;
uint32_t morphBitShiftLeft;

//import pointer to struct that contains our wavetable family info

//this is used for our 1v/oct and bonus expo envelope


//these are the variables used to generate the phase information that feeds our interpolations
int fixMorph;
int getMorph;

uint32_t morphCVAverage;
uint32_t morphCVLongAverage;

uint32_t attackInc;
uint32_t releaseInc;
uint32_t catchupInc;
uint32_t gateOnCount;
uint32_t periodCount;
int incSign;
int time1;
int time2;

int holdPosition;

//lastest result of the biinterpolation between interp1 and interp2 (scaled in drum mode)
int out;


int fix16_mul(int, int)  __attribute__((section("ccmram")));
int fix24_mul(int, int)  __attribute__((section("ccmram")));
int fix48_mul(uint32_t, uint32_t)  __attribute__((section("ccmram")));
int fix16_lerp(int, int, uint16_t)  __attribute__((section("ccmram")));


// ADC variables and defines

#define time2Knob ADCReadings2[0]
#define morphKnob (ADCReadings2[1] & 0b11111111111111111111111111100000)
#define time1CV (ADCReadings1[0] & 0b111111111111111111111111111000)
#define time2CV (ADCReadings1[1] & 0b11111111111111111111111111111111)
#define morphCV (ADCReadings1[2] & 0b1111111111111111111111111100000)
#define time1Knob (ADCReadings3[0] & 0b1111111111111111111111111100000)

//#define morphKnob 4000
//#define morphCV 50







void inputCapture(void)  __attribute__((section("ccmram")));
void tapTempo(void) __attribute__((section("ccmram")));
void generateFrequency(void) __attribute__((section("ccmram")));
void dacISR(void)  __attribute__((section("ccmram")));
