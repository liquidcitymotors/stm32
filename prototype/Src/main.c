/**
  ******************************************************************************
  * File Name          : main.c
  * Description        : Main program body
  ******************************************************************************
  ** This notice applies to any and all portions of this file
  * that are not between comment pairs USER CODE BEGIN and
  * USER CODE END. Other portions of this file, whether 
  * inserted by the user or by software development tools
  * are owned by their respective copyright owners.
  *
  * COPYRIGHT(c) 2017 STMicroelectronics
  *
  * Redistribution and use in source and binary forms, with or without modification,
  * are permitted provided that the following conditions are met:
  *   1. Redistributions of source code must retain the above copyright notice,
  *      this list of conditions and the following disclaimer.
  *   2. Redistributions in binary form must reproduce the above copyright notice,
  *      this list of conditions and the following disclaimer in the documentation
  *      and/or other materials provided with the distribution.
  *   3. Neither the name of STMicroelectronics nor the names of its contributors
  *      may be used to endorse or promote products derived from this software
  *      without specific prior written permission.
  *
  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  *
  ******************************************************************************
  */
/* Includes ------------------------------------------------------------------*/
#include "main.h"
#include "stm32f3xx_hal.h"

/* USER CODE BEGIN Includes */


#include "tables.h"
#include "tsl_user.h"

/* USER CODE END Includes */

/* Private variables ---------------------------------------------------------*/
ADC_HandleTypeDef hadc1;
ADC_HandleTypeDef hadc2;
ADC_HandleTypeDef hadc3;
DMA_HandleTypeDef hdma_adc1;
DMA_HandleTypeDef hdma_adc2;
DMA_HandleTypeDef hdma_adc3;

DAC_HandleTypeDef hdac;
DMA_HandleTypeDef hdma_dac_ch1;
DMA_HandleTypeDef hdma_dac_ch2;

TIM_HandleTypeDef htim1;
TIM_HandleTypeDef htim2;
TIM_HandleTypeDef htim3;
TIM_HandleTypeDef htim6;

TSC_HandleTypeDef htsc;

/* USER CODE BEGIN PV */
/* Private variables ---------------------------------------------------------*/
tsl_user_status_t tsl_status;

__IO uint32_t uhTSCAcquisitionValue1;
__IO uint32_t uhTSCAcquisitionValue2;
__IO uint32_t uhTSCAcquisitionValue3;
int not1;
int not2;
int not3;
int modeflag;
int modechanged;
int pindownlastcycle;
int temp1 = 0;
int temp2 = 0;
int temp3 = 0;
int temp4 = 0;
extern uint16_t dacbuffer1[1];
extern uint16_t dacbuffer2[1];
extern int span;
extern int spanx2;
Family moog1;
Family moog2;
Family triFudge;
Family triOdd;
Family triFold;
Family bounce;
Family sineFold;
Family perlin;


const uint16_t sinefold_ctr_1[65] = {0,1755,3221,4645,6025,7357,8637,9863,11031,12137,13180,14156,15062,15896,16655,17337,17940,18463,18903,19259,19530,19715,19812,19822,19745,19579,19325,18984,18556,18042,17444,16762,15997,15259,14604,14034,13550,13154,12845,12624,12492,12448,12493,12624,12843,13148,13537,14009,14563,15197,15909,16696,17557,18488,19487,20551,21677,22863,24104,25398,26741,28130,29561,31030,32768};
const uint16_t sinefold_ctr_2[65] = {0,735,1259,1832,2482,3231,4097,5090,6218,7480,8869,10372,11969,13636,15341,17052,18730,20335,21825,23161,24303,25213,25859,26213,26252,25964,25339,24379,23093,21501,19628,17509,15187,12963,10988,9296,7917,6870,6166,5806,5785,6088,6693,7574,8696,10023,11515,13131,14828,16565,18303,20007,21645,23190,24621,25924,27091,28119,29012,29783,30447,31025,31543,32030,32768};
const uint16_t sinefold_ctr_3[65] = {0,1698,2972,4008,4759,5208,5364,5267,4983,4601,4226,3968,3938,4234,4933,6083,7697,9753,12185,14894,17747,20586,23240,25535,27307,28412,28742,28231,26863,24677,21768,18281,14409,10771,7722,5412,3942,3356,3639,4728,6512,8846,11561,14478,17418,20219,22740,24873,26549,27737,28448,28727,28651,28318,27841,27335,26911,26662,26663,26961,27572,28483,29656,31026,32768};
const uint16_t sinefold_ctr_4[65] = {0,827,1647,2786,4263,6018,7918,9775,11374,12512,13030,12844,11969,10523,8724,6864,5274,4281,4160,5092,7127,10171,13982,18193,22350,25964,28571,29796,29408,27353,23780,19032,13614,8672,4934,2756,2299,3514,6166,9871,14153,18505,22452,25608,27717,28670,28514,27428,25695,23655,21655,20007,18947,18612,19030,20124,21737,23660,25668,27557,29175,30442,31360,32006,32768};
const uint16_t sinefold_ctr_5[65] = {0,1576,2476,2878,2871,2694,2678,3159,4381,6420,9135,12181,15062,17239,18250,17829,15991,13057,9621,6444,4306,3841,5390,8900,13903,19579,24897,28810,30469,29407,25662,19805,12856,6767,2848,1696,3360,7368,12845,18710,23890,27526,29122,28610,26333,22945,19260,16080,14038,13488,14462,16696,19711,22937,25840,28032,29339,29815,29699,29340,29097,29247,29920,31077,32768};
const uint16_t sinefold_ctr_6[65] = {0,977,2212,3929,5831,7442,8290,8112,6998,5417,4099,3814,5096,8024,12132,16485,19931,21445,20475,17162,12380,7530,4166,3534,6163,11644,18681,25400,29868,30658,27309,20531,12068,5026,1515,2280,6858,13784,21058,26733,29449,28766,25218,20093,15011,11449,10339,11855,15433,20004,24346,27453,28799,28436,26914,25047,23638,23227,23960,25598,27651,29594,31059,31964,32768};
const uint16_t sinefold_ctr_7[65] = {0,1403,1889,1892,1985,2828,4785,7645,10624,12658,12901,11177,8184,5312,4112,5618,9820,15529,20752,23450,22400,17800,11328,5581,3088,5257,11703,20262,27730,31090,28747,21273,11321,3559,1087,4514,12206,21050,27721,29956,27333,21299,14479,9592,8413,11176,16624,22618,27044,28617,27287,24128,20787,18775,18889,20990,24192,27338,29519,30429,30392,30108,30246,31109,32768};
const uint16_t sinefold_ctr_8[65] = {0,1183,2787,4626,5846,5807,4645,3364,3333,5433,9376,13652,16226,15679,12144,7468,4397,5132,10028,17171,23183,24917,21207,13688,6178,2812,5853,14324,24276,30659,29922,21997,10574,2346,1533,8091,18364,27125,30263,26737,18873,10971,7023,8770,15021,22496,27632,28380,25071,20011,16123,15415,18087,22653,26917,29192,29085,27501,25944,25602,26747,28760,30686,31907,32768};
const uint16_t sinefold_ctr_9[65] = {0,1208,1408,1616,2871,5455,8387,9978,9130,6420,4019,4332,8189,13940,18250,18266,13738,7559,4126,6444,13876,22185,26075,22715,13903,5260,2754,8701,19910,29407,30828,22720,9847,1428,2848,12632,24214,30362,27737,18710,9474,5901,9905,18561,26333,28746,25082,18474,13573,13488,18015,24142,28274,28564,25840,22689,21546,23154,26386,29340,30779,30849,30655,31193,32768};

const uint16_t perlin6_1[65] = {0,506,1016,1530,2048,2571,3098,3630,4167,4710,5257,5809,6366,6928,7494,8065,8640,9220,9803,10389,10933,11475,12016,12554,13089,13621,14150,14676,15197,15715,16231,16744,17256,17766,18275,18781,19286,19789,20290,20789,21287,21783,22277,22770,23261,23750,24182,24615,25048,25482,25917,26354,26792,27232,27675,28119,28567,29017,29470,29926,30386,30850,31317,31788,32768};
const uint16_t perlin6_2[65] = {0,509,1030,1565,2116,2686,3276,3889,4524,5184,5869,6581,7318,8081,8870,9683,10520,11380,12259,13157,13870,14574,15268,15949,16614,17263,17893,18501,19087,19648,20197,20734,21260,21776,22280,22773,23255,23726,24187,24636,25075,25504,25921,26329,26726,27113,27263,27418,27580,27749,27928,28118,28320,28537,28770,29020,29288,29577,29887,30220,30576,30958,31366,31801,32768};
const uint16_t perlin6_3[65] = {0,637,1150,1548,1842,2049,2186,2275,2335,2390,2463,2576,2753,3013,3377,3863,4484,5252,6175,7256,8573,9949,11363,12796,14225,15624,16967,18225,19367,20374,21300,22158,22947,23670,24327,24920,25450,25919,26331,26687,26992,27249,27461,27633,27769,27874,27703,27559,27450,27383,27364,27399,27490,27640,27850,28120,28447,28827,29255,29724,30223,30741,31263,31774,32768};
const uint16_t perlin6_4[65] = {0,1104,2256,3414,4530,5550,6422,7101,7551,7753,7706,7435,6969,6171,5095,3860,2598,1447,539,0,442,1391,2821,4676,6872,9297,11811,14244,16402,18109,19518,20675,21586,22265,22729,23001,23109,23084,22963,22788,22606,22466,22427,22548,22894,23537,24453,25507,26569,27550,28392,29063,29553,29874,30049,30115,30113,30092,30097,30171,30346,30647,31079,31626,32768};
const uint16_t perlin6_5[65] = {0,499,902,1384,2080,3062,4289,5573,6561,7774,9487,11465,13433,15108,16235,16623,16181,14956,13166,10795,7881,5388,3857,3617,4786,7268,10755,14729,18458,21149,23030,24234,24826,24907,24614,24122,23639,23410,23718,24874,26758,28827,30689,32061,32768,32748,31582,30074,28532,27293,26472,25874,25616,25740,26216,26966,27871,28806,29654,30328,30774,31024,31290,31695,32768};
const uint16_t perlin6_6[65] = {0,788,1427,2217,3244,4395,5371,5701,4859,3531,2511,2335,3263,5117,7114,8212,10359,13034,15132,15838,14533,11966,8845,5193,2606,2214,4304,8321,12867,15992,17702,18286,18014,17297,16689,16888,18578,20974,22948,23838,23423,21917,19975,18425,17110,16425,16970,18312,20051,21630,22324,21970,21562,21703,22599,24151,26062,27964,29499,30411,30778,30879,31047,31515,32768};
const uint16_t perlin6_7[65] = {0,937,1522,2229,4238,7257,9498,9498,7319,5535,6018,7917,9727,9496,5678,2034,1274,3929,8008,10336,14681,17905,17712,14140,8920,3467,1989,5823,12719,17537,19360,19052,17779,17313,19715,23299,25128,24154,21193,18510,16540,16233,17764,20098,20845,18603,16927,17695,20985,25530,29335,30539,29242,27090,26102,24823,24498,25688,27786,29618,30428,30697,30966,31532,32768};
const uint16_t perlin6_8[65] = {0,732,1600,2059,1672,2325,5490,7424,6651,5814,9852,16521,17502,11423,7005,8782,11929,10370,2717,0,5062,10222,15607,19933,17642,10620,2893,3240,11926,18684,20047,18398,17675,21936,25633,24350,19955,16641,15944,18468,20719,17637,15180,17907,25024,31174,30392,25532,22472,19214,20437,25394,28710,28524,27257,27795,29755,30221,29518,29293,30185,30903,31182,31418,32768};
const uint16_t perlin6_9[65] = {0,891,1396,1274,1955,3741,4554,4824,5999,4396,3821,8798,9933,7145,10625,18843,15572,7019,8364,11363,5181,821,6172,10989,16882,15319,7315,2095,9076,16039,16248,14467,17988,21186,17975,13935,13044,15952,15240,12004,15182,22729,24628,19481,15160,12879,18936,23570,22479,21810,25200,25563,23796,24810,26072,25319,22196,22622,27131,30539,30446,29524,29958,31137,32768};

const uint16_t bounce1[65] = {0,543,1136,1766,2419,3082,3741,4384,4999,5575,6099,6564,6962,7284,7526,7684,7756,7741,7640,7455,7190,6852,6447,5984,5473,4923,4348,3759,3170,2594,2044,1536,1081,694,387,172,60,60,181,429,811,1329,1985,2780,3710,4773,5962,7269,8685,10197,11793,13457,15174,16925,18692,20455,22194,23888,25516,27058,28492,29799,30959,31954,32768};
const uint16_t bounce2[65] = {0,554,1157,1774,2369,2910,3371,3732,3980,4111,4130,4049,3891,3681,3454,3245,3090,3026,3086,3297,3680,4246,4999,5929,7018,8238,9549,10907,12259,13551,14725,15728,16509,17025,17241,17136,16701,15940,14874,13538,11981,10263,8456,6639,4896,3311,1967,940,297,91,361,1126,2388,4127,6303,8857,11710,14772,17936,21091,24121,26908,29343,31325,32768};
const uint16_t bounce3[65] = {0,570,1185,1769,2260,2611,2800,2833,2742,2581,2419,2334,2400,2677,3203,3988,5009,6212,7511,8803,9970,10897,11482,11650,11360,10616,9469,8013,6382,4738,3256,2112,1458,1416,2055,3386,5360,7859,10715,13714,16619,19185,21187,22436,22803,22230,20740,18440,15514,12208,8816,5651,3020,1196,393,745,2287,4956,8585,12917,17625,22337,26667,30249,32768};
const uint16_t bounce4[65] = {0,589,1204,1721,2054,2173,2109,1953,1831,1878,2204,2869,3861,5093,6408,7610,8492,8883,8678,7873,6568,4969,3352,2031,1299,1377,2374,4252,6828,9788,12727,15217,16867,17393,16673,14772,11949,8624,5323,2599,947,721,2075,4922,8941,13610,18284,22283,24999,25997,25081,22347,18169,13160,8088,3758,898,36,1418,4957,10233,16548,23018,28709,32768};
const uint16_t bounce5[65] = {0,610,1212,1629,1777,1698,1539,1510,1805,2529,3647,4976,6225,7068,7246,6649,5376,3731,2164,1166,1137,2272,4482,7394,10413,12861,14137,13881,12086,9124,5685,2630,792,763,2738,6436,11142,15851,19496,21205,20517,17524,12871,7638,3097,418,390,3204,8390,14889,21288,26132,28273,27153,22961,16619,9592,3563,45,16,3670,10343,18637,26726,32768};
const uint16_t bounce6[65] = {0,631,1204,1500,1485,1331,1336,1768,2722,4037,5330,6131,6082,5114,3524,1914,994,1319,3052,5850,8934,11323,12178,11121,8419,4952,1954,603,1603,4891,9605,14320,17506,18052,15680,11098,5815,1677,250,2265,7325,13973,20134,23790,23666,19705,13143,6157,1165,24,3378,10382,18931,26309,30085,28937,23146,14559,6030,501,16,5004,14080,24443,32768};
const uint16_t bounce7[65] = {0,651,1184,1353,1236,1184,1590,2606,3982,5145,5489,4736,3170,1583,939,1882,4349,7496,10016,10732,9201,6018,2639,777,1593,5094,10021,14330,16091,14408,9917,4608,995,987,4959,11476,17842,21263,20125,14810,7630,1874,363,4129,11855,20357,25945,26076,20564,11773,3655,31,2850,11231,21744,29860,31954,26977,17029,6526,295,1412,9754,21947,32768};
const uint16_t bounce8[65] = {0,650,1114,1164,1040,1255,2141,3492,4601,4719,3638,1980,928,1510,3857,6959,9141,9061,6615,3175,910,1520,5127,10027,13555,13618,10029,4785,1051,1344,5968,12666,17778,18333,13859,6837,1413,1042,6408,14852,21751,23140,18074,9351,2053,680,6482,16570,25418,27974,22636,12337,3027,325,6230,17813,28726,32768,27499,15799,4383,44,5702,18583,31630};
const uint16_t bounce9[65] = {0,640,1024,974,937,1514,2762,3963,4150,3015,1392,780,2174,5098,7715,8103,5800,2406,609,2218,6638,11042,12296,9328,4155,657,1810,7364,13754,16501,13490,6726,1145,1151,7317,15703,20484,18130,10149,2271,471,6597,16789,24013,23047,14395,4197,10,5355,16969,26879,28009,19372,7038,9,3792,16260,28903,32768,24934,10853,694,2141,14740,29954};

const uint16_t trifold_1[65] = {0,512,1024,1536,2048,2560,3072,3584,4096,4608,5120,5632,6144,6656,7168,7680,8192,8704,9216,9728,10240,10752,11264,11776,12288,12800,13312,13824,14336,14848,15360,15872,16384,16896,17408,17920,18432,18944,19456,19968,20480,20992,21504,22016,22528,23040,23552,24064,24576,25088,25600,26112,26624,27136,27648,28160,28672,29184,29696,30208,30720,31232,31744,32256,32768};
const uint16_t trifold_2[65] = {32768,31232,29696,28160,26624,25088,23552,22016,20480,18944,17408,15872,14336,12800,11264,9728,8192,6656,5120,3584,2048,512,0,1536,3072,4608,6144,7680,9216,10752,12288,13824,15360,16896,18432,19968,21504,23040,24576,26112,27648,29184,30720,32256,31744,30208,28672,27136,25600,24064,22528,20992,19456,17920,16384,14848,13312,11776,10240,8704,7168,5632,4096,2560,1024};
const uint16_t trifold_3[65] = {16384,18432,20480,22528,24576,26624,28672,30720,32768,31232,29184,27136,25088,23040,20992,18944,16896,14848,12800,10752,8704,6656,4608,2560,512,1024,3072,5120,7168,9216,11264,13312,15360,17408,19456,21504,23552,25600,27648,29696,31744,32256,30208,28160,26112,24064,22016,19968,17920,15872,13824,11776,9728,7680,5632,3584,1536,0,2048,4096,6144,8192,10240,12288,14336};
const uint16_t trifold_4[65] = {0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247,32768,30247,27727,25206,22686,20165,17644,15124,12603,10082,7562,5041,2521,0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247,32768,30247,27727,25206,22686,20165,17644,15124,12603,10082,7562,5041,2521,0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247};
const uint16_t trifold_5[65] = {16384,13312,10240,7168,4096,1024,1536,4608,7680,10752,13824,16896,19968,23040,26112,29184,32256,30720,27648,24576,21504,18432,15360,12288,9216,6144,3072,0,2560,5632,8704,11776,14848,17920,20992,24064,27136,30208,32768,29696,26624,23552,20480,17408,14336,11264,8192,5120,2048,512,3584,6656,9728,12800,15872,18944,22016,25088,28160,31232,31744,28672,25600,22528,19456};
const uint16_t trifold_6[65] = {32768,29184,25600,22016,18432,14848,11264,7680,4096,512,2048,5632,9216,12800,16384,19968,23552,27136,30720,31232,27648,24064,20480,16896,13312,9728,6144,2560,0,3584,7168,10752,14336,17920,21504,25088,28672,32256,29696,26112,22528,18944,15360,11776,8192,4608,1024,1536,5120,8704,12288,15872,19456,23040,26624,30208,31744,28160,24576,20992,17408,13824,10240,6656,3072};
const uint16_t trifold_7[65] = {16384,20480,24576,28672,32768,29184,25088,20992,16896,12800,8704,4608,512,3072,7168,11264,15360,19456,23552,27648,31744,30208,26112,22016,17920,13824,9728,5632,1536,2048,6144,10240,14336,18432,22528,26624,30720,31232,27136,23040,18944,14848,10752,6656,2560,1024,5120,9216,13312,17408,21504,25600,29696,32256,28160,24064,19968,15872,11776,7680,3584,0,4096,8192,12288};
const uint16_t trifold_8[65] = {0,4608,9216,13824,18432,23040,27648,32256,29696,25088,20480,15872,11264,6656,2048,2560,7168,11776,16384,20992,25600,30208,31744,27136,22528,17920,13312,8704,4096,512,5120,9728,14336,18944,23552,28160,32768,29184,24576,19968,15360,10752,6144,1536,3072,7680,12288,16896,21504,26112,30720,31232,26624,22016,17408,12800,8192,3584,1024,5632,10240,14848,19456,24064,28672};
const uint16_t trifold_9[65] = {16384,10923,5461,0,2731,8192,13653,19115,24576,30037,32768,27307,21845,16384,10923,5461,0,2731,8192,13653,19115,24576,30037,32768,27307,21845,16384,10923,5461,0,2731,8192,13653,19115,24576,30037,32768,27307,21845,16384,10923,5461,0,2731,8192,13653,19115,24576,30037,32768,27307,21845,16384,10923,5461,0,2731,8192,13653,19115,24576,30037,32768,27307,21845};


const uint16_t triodd_1[65] = {0,512,1024,1536,2048,2560,3072,3584,4096,4608,5120,5632,6144,6656,7168,7680,8192,8704,9216,9728,10240,10752,11264,11776,12288,12800,13312,13824,14336,14848,15360,15872,16384,16896,17408,17920,18432,18944,19456,19968,20480,20992,21504,22016,22528,23040,23552,24064,24576,25088,25600,26112,26624,27136,27648,28160,28672,29184,29696,30208,30720,31232,31744,32256,32768};
const uint16_t triodd_2[65] = {1024,2560,4096,5632,7168,8704,10240,11776,13312,14848,16384,17920,19456,20992,22528,24064,25600,27136,28672,30208,31744,32256,30720,29184,27648,26112,24576,23040,21504,19968,18432,16896,15360,13824,12288,10752,9216,7680,6144,4608,3072,1536,0,512,2048,3584,5120,6656,8192,9728,11264,12800,14336,15872,17408,18944,20480,22016,23552,25088,26624,28160,29696,31232,32768};
const uint16_t triodd_3[65] = {0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247,32768,30247,27727,25206,22686,20165,17644,15124,12603,10082,7562,5041,2521,0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247,32768,30247,27727,25206,22686,20165,17644,15124,12603,10082,7562,5041,2521,0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247};
const uint16_t triodd_4[65] = {3072,6656,10240,13824,17408,20992,24576,28160,31744,30208,26624,23040,19456,15872,12288,8704,5120,1536,1024,4608,8192,11776,15360,18944,22528,26112,29696,32256,28672,25088,21504,17920,14336,10752,7168,3584,0,2560,6144,9728,13312,16896,20480,24064,27648,31232,30720,27136,23552,19968,16384,12800,9216,5632,2048,512,4096,7680,11264,14848,18432,22016,25600,29184,32768};
const uint16_t triodd_5[65] = {0,4608,9216,13824,18432,23040,27648,32256,29696,25088,20480,15872,11264,6656,2048,2560,7168,11776,16384,20992,25600,30208,31744,27136,22528,17920,13312,8704,4096,512,5120,9728,14336,18944,23552,28160,32768,29184,24576,19968,15360,10752,6144,1536,3072,7680,12288,16896,21504,26112,30720,31232,26624,22016,17408,12800,8192,3584,1024,5632,10240,14848,19456,24064,28672};
const uint16_t triodd_6[65] = {5120,10752,16384,22016,27648,32256,26624,20992,15360,9728,4096,512,6144,11776,17408,23040,28672,31232,25600,19968,14336,8704,3072,1536,7168,12800,18432,24064,29696,30208,24576,18944,13312,7680,2048,2560,8192,13824,19456,25088,30720,29184,23552,17920,12288,6656,1024,3584,9216,14848,20480,26112,31744,28160,22528,16896,11264,5632,0,4608,10240,15872,21504,27136,32768};
const uint16_t triodd_7[65] = {0,6554,13107,19661,26214,32768,26214,19661,13107,6554,0,6554,13107,19661,26214,32768,26214,19661,13107,6554,0,6554,13107,19661,26214,32768,26214,19661,13107,6554,0,6554,13107,19661,26214,32768,26214,19661,13107,6554,0,6554,13107,19661,26214,32768,26214,19661,13107,6554,0,6554,13107,19661,26214,32768,26214,19661,13107,6554,0,6554,13107,19661,26214};
const uint16_t triodd_8[65] = {7562,15124,22686,30247,27727,20165,12603,5041,2521,10082,17644,25206,32768,25206,17644,10082,2521,5041,12603,20165,27727,30247,22686,15124,7562,0,7562,15124,22686,30247,27727,20165,12603,5041,2521,10082,17644,25206,32768,25206,17644,10082,2521,5041,12603,20165,27727,30247,22686,15124,7562,0,7562,15124,22686,30247,27727,20165,12603,5041,2521,10082,17644,25206,32768};
const uint16_t triodd_9[65] = {0,8704,17408,26112,31744,23040,14336,5632,3072,11776,20480,29184,28672,19968,11264,2560,6144,14848,23552,32256,25600,16896,8192,512,9216,17920,26624,31232,22528,13824,5120,3584,12288,20992,29696,28160,19456,10752,2048,6656,15360,24064,32768,25088,16384,7680,1024,9728,18432,27136,30720,22016,13312,4608,4096,12800,21504,30208,27648,18944,10240,1536,7168,15872,24576};

const uint16_t trifudge_1[65] = {256,752,1248,1744,2240,2736,3232,3728,4224,4720,5216,5712,6208,6704,7200,7696,8192,8704,9216,9728,10240,10752,11264,11776,12288,12800,13312,13824,14336,14848,15360,15872,16384,16896,17408,17920,18432,18944,19456,19968,20480,20992,21504,22016,22528,23040,23552,24064,24576,25104,25632,26160,26688,27216,27744,28272,28800,29328,29856,30384,30912,31440,31968,32496,32512};
const uint16_t trifudge_2[65] = {0,1632,3328,5088,6912,8800,10752,12768,14848,16992,19200,21472,23808,26208,28672,31200,32256,31232,30208,29184,28160,27136,26112,25088,24064,23040,22016,20992,19968,18944,17920,16896,15872,14848,13824,12800,11776,10752,9728,8704,7680,6656,5632,4608,3584,2560,1536,512,0,2528,4992,7392,9728,12000,14208,16352,18432,20448,22400,24288,26112,27872,29568,31200,32768};
const uint16_t trifudge_3[65] = {1024,2560,4096,5632,7168,8704,10240,11776,13312,14848,16384,17920,19456,20992,22528,24064,25600,27136,28672,30208,31744,32256,30720,29184,27648,26112,24576,23040,21504,19968,18432,16896,15360,13824,12288,10752,9216,7680,6144,4608,3072,1536,0,512,2048,3584,5120,6656,8192,9728,11264,12800,14336,15872,17408,18944,20480,22016,23552,25088,26624,28160,29696,31232,32768};
const uint16_t trifudge_4[65] = {0,3072,6583,10533,14921,19749,25015,30720,32768,31232,29184,27136,25088,23040,20992,18944,16896,14848,12800,10752,8704,6656,4608,2560,512,1024,3072,5120,7168,9216,11264,13312,15360,17408,19456,21504,23552,25600,27648,29696,31744,32256,30208,28160,26112,24064,22016,19968,17920,15872,13824,11776,9728,7680,5632,3584,1536,0,5998,11557,16677,21358,25600,29403,32768};
const uint16_t trifudge_5[65] = {0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247,32768,30247,27727,25206,22686,20165,17644,15124,12603,10082,7562,5041,2521,0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247,32768,30247,27727,25206,22686,20165,17644,15124,12603,10082,7562,5041,2521,0,2521,5041,7562,10082,12603,15124,17644,20165,22686,25206,27727,30247};
const uint16_t trifudge_6[65] = {0,6016,13312,21888,31744,31232,28160,25088,22016,18944,15872,12800,9728,6656,3584,512,2048,5120,8192,11264,14336,17408,20480,23552,26624,29696,32768,30208,27136,24064,20992,17920,14848,11776,8704,5632,2560,0,3072,6144,9216,12288,15360,18432,21504,24576,27648,30720,32256,29184,26112,23040,19968,16896,13824,10752,7680,4608,1536,1024,4096,13184,20992,27520,32768};
const uint16_t trifudge_7[65] = {3072,6656,10240,13824,17408,20992,24576,28160,31744,30208,26624,23040,19456,15872,12288,8704,5120,1536,1024,4608,8192,11776,15360,18944,22528,26112,29696,32256,28672,25088,21504,17920,14336,10752,7168,3584,0,2560,6144,9728,13312,16896,20480,24064,27648,31232,30720,27136,23552,19968,16384,12800,9216,5632,2048,512,4096,7680,11264,14848,18432,22016,25600,29184,32768};
const uint16_t trifudge_8[65] = {0,7168,16725,28672,32768,29184,25088,20992,16896,12800,8704,4608,512,3072,7168,11264,15360,19456,23552,27648,31744,30208,26112,22016,17920,13824,9728,5632,1536,2048,6144,10240,14336,18432,22528,26624,30720,31232,27136,23040,18944,14848,10752,6656,2560,1024,5120,9216,13312,17408,21504,25600,29696,32256,28160,24064,19968,15872,11776,7680,3584,0,13312,24235,32768};
const uint16_t trifudge_9[65] = {0,4608,9216,13824,18432,23040,27648,32256,29696,25088,20480,15872,11264,6656,2048,2560,7168,11776,16384,20992,25600,30208,31744,27136,22528,17920,13312,8704,4096,512,5120,9728,14336,18944,23552,28160,32768,29184,24576,19968,15360,10752,6144,1536,3072,7680,12288,16896,21504,26112,30720,31232,26624,22016,17408,12800,8192,3584,1024,5632,10240,14848,19456,24064,28672};

const uint16_t moog1attack[65] = { 21659 ,  21503 ,  20634 ,  18818 ,  16219 ,  13251 ,  10408 ,   8124 , 6692 ,   6231 ,   6690 ,   7878 ,   9512 ,  11283 ,12902 ,  14146 , 14884 ,  15086 ,  14809 ,  14180 ,  13364 ,  12531 ,  11830 ,  11367 , 11196 ,  11315 ,  11676 ,  12202 ,  12798 ,  13372 ,  13850 ,  14183 , 14352 ,  14367 ,  14262 ,  14084 ,  13886 ,  13715 ,  13609 ,  13588 , 13658 ,  13807 ,  14014 ,  14251 ,  14490 ,  14705 ,  14880 ,  15005 , 15082 ,  15119 ,  15129 ,  15128 ,  15131 ,  15151 ,  15195 ,  15267 , 15365 ,  15483 ,  15612 ,  15745 ,  15872 ,  15988 ,  16090 ,  16177 , 16251 };
const uint16_t moog1release[65] = { 21602 ,  21529 ,  21444 ,  21360 ,  21275 ,  21190 ,  21105 ,  21020 , 20934 ,  20849 ,  20764 ,  20679 ,  20594 ,  20509 ,  20424 ,  20340 , 20256 ,  20172 ,  20087 ,  20003 ,  19918 ,  19833 ,  19747 ,  19661 , 19575 ,  19488 ,  19403 ,  19317 ,  19233 ,  19149 ,  19066 ,  18983 , 18901 ,  18818 ,  18735 ,  18650 ,  18564 ,  18477 ,  18388 ,  18299 , 18210 ,  18121 ,  18034 ,  17950 ,  17868 ,  17788 ,  17710 ,  17633 , 17556 ,  17477 ,  17394 ,  17307 ,  17216 ,  17120 ,  17022 ,  16922 , 16825 ,  16731 ,  16645 ,  16566 ,  16496 ,  16433 ,  16374 ,  16315 , 16251 };
const uint16_t moog2attack[65] = { 21503 ,  21557 ,  21528 ,  21343 ,  20945 ,  20305 ,  19421 ,  18318 , 17038 ,  15636 ,  14173 ,  12714 ,  11320 ,  10046 ,   8940 ,   8037 , 7366 ,   6939 ,   6760 ,   6822 ,   7107 ,   7591 ,   8243 ,   9025 , 9899 ,  10825 ,  11764 ,  12680 ,  13539 ,  14313 ,  14979 ,  15522 , 15931 ,  16203 ,  16340 ,  16350 ,  16246 ,  16045 ,  15764 ,  15426 , 15053 ,  14667 ,  14287 ,  13934 ,  13623 ,  13368 ,  13179 ,  13062 , 13021 ,  13055 ,  13161 ,  13332 ,  13559 ,  13834 ,  14144 ,  14477 , 14821 ,  15165 ,  15497 ,  15808 ,  16090 ,  16338 ,  16546 ,  16713 , 16839 };
const uint16_t moog2release[65] = { 21455 ,  21377 ,  21295 ,  21209 ,  21120 ,  21026 ,  20929 ,  20829 , 20725 ,  20619 ,  20510 ,  20401 ,  20293 ,  20185 ,  20080 ,  19978 , 19881 ,  19789 ,  19704 ,  19625 ,  19553 ,  19489 ,  19430 ,  19378 , 19331 ,  19287 ,  19246 ,  19204 ,  19162 ,  19115 ,  19063 ,  19003 , 18933 ,  18853 ,  18761 ,  18656 ,  18538 ,  18408 ,  18267 ,  18117 , 17959 ,  17796 ,  17632 ,  17470 ,  17313 ,  17166 ,  17031 ,  16913 , 16813 ,  16735 ,  16680 ,  16647 ,  16637 ,  16648 ,  16677 ,  16721 , 16775 ,  16834 ,  16891 ,  16940 ,  16974 ,  16987 ,  16972 ,  16924 , 16839 };
const uint16_t moog3attack[65] = { 21000 ,  21133 ,  21247 ,  21318 ,  21324 ,  21244 ,  21061 ,  20767 , 20358 ,  19836 ,  19207 ,  18482 ,  17675 ,  16804 ,  15885 ,  14937 , 13981 ,  13035 ,  12116 ,  11244 ,  10431 ,   9694 ,   9042 ,   8486 , 8034 ,   7689 ,   7454 ,   7331 ,   7317 ,   7409 ,   7601 ,   7887 , 8257 ,   8703 ,   9213 ,   9776 ,  10381 ,  11015 ,  11667 ,  12326 , 12979 ,  13617 ,  14229 ,  14808 ,  15346 ,  15835 ,  16272 ,  16651 , 16971 ,  17229 ,  17426 ,  17563 ,  17642 ,  17665 ,  17637 ,  17562 , 17446 ,  17295 ,  17114 ,  16911 ,  16692 ,  16464 ,  16232 ,  16004 , 15784 };
const uint16_t moog3release[65] = { 20885 ,  20751 ,  20621 ,  20496 ,  20376 ,  20264 ,  20158 ,  20062 , 19975 ,  19897 ,  19829 ,  19772 ,  19725 ,  19688 ,  19661 ,  19643 , 19633 ,  19631 ,  19634 ,  19641 ,  19652 ,  19663 ,  19674 ,  19682 , 19685 ,  19682 ,  19670 ,  19647 ,  19612 ,  19563 ,  19499 ,  19417 , 19318 ,  19201 ,  19065 ,  18911 ,  18738 ,  18547 ,  18341 ,  18119 , 17885 ,  17640 ,  17388 ,  17130 ,  16870 ,  16612 ,  16359 ,  16115 , 15883 ,  15667 ,  15470 ,  15296 ,  15148 ,  15027 ,  14937 ,  14879 , 14855 ,  14864 ,  14907 ,  14983 ,  15091 ,  15228 ,  15392 ,  15578 , 15784 };
const uint16_t moog5attack[65] = { 21901 ,  21982 ,  22047 ,  22087 ,  22093 ,  22057 ,  21970 ,  21826 , 21619 ,  21347 ,  21009 ,  20606 ,  20140 ,  19614 ,  19035 ,  18407 , 17739 ,  17038 ,  16312 ,  15569 ,  14819 ,  14069 ,  13328 ,  12604 , 11905 ,  11238 ,  10610 ,  10027 ,   9494 ,   9015 ,   8596 ,   8238 , 7945 ,   7718 ,   7557 ,   7463 ,   7435 ,   7473 ,   7573 ,   7734 , 7952 ,   8223 ,   8544 ,   8911 ,   9318 ,   9760 ,  10233 ,  10731 , 11249 ,  11781 ,  12322 ,  12866 ,  13410 ,  13947 ,  14473 ,  14984 , 15477 ,  15946 ,  16390 ,  16805 ,  17188 ,  17539 ,  17854 ,  18134 , 18377 };
const uint16_t moog5release[65] = { 21874 ,  21772 ,  21659 ,  21535 ,  21400 ,  21253 ,  21096 ,  20928 , 20750 ,  20563 ,  20367 ,  20164 ,  19954 ,  19738 ,  19518 ,  19294 , 19070 ,  18845 ,  18622 ,  18401 ,  18186 ,  17976 ,  17775 ,  17583 , 17403 ,  17235 ,  17081 ,  16943 ,  16821 ,  16716 ,  16631 ,  16565 , 16518 ,  16492 ,  16486 ,  16501 ,  16535 ,  16589 ,  16662 ,  16753 , 16860 ,  16982 ,  17117 ,  17263 ,  17419 ,  17582 ,  17749 ,  17917 , 18085 ,  18250 ,  18407 ,  18555 ,  18690 ,  18809 ,  18910 ,  18990 , 19046 ,  19075 ,  19075 ,  19045 ,  18982 ,  18885 ,  18752 ,  18583 , 18377 };
const uint16_t moog6attack[65] = { 19268 ,  19400 ,  19537 ,  19676 ,  19810 ,  19933 ,  20041 ,  20127 , 20187 ,  20217 ,  20213 ,  20172 ,  20093 ,  19974 ,  19816 ,  19617 , 19380 ,  19105 ,  18795 ,  18452 ,  18078 ,  17677 ,  17253 ,  16808 , 16347 ,  15873 ,  15390 ,  14902 ,  14414 ,  13928 ,  13448 ,  12978 , 12522 ,  12082 ,  11662 ,  11265 ,  10893 ,  10549 ,  10234 ,   9950 , 9700 ,   9484 ,   9303 ,   9159 ,   9051 ,   8980 ,   8946 ,   8948 , 8986 ,   9059 ,   9167 ,   9307 ,   9479 ,   9681 ,   9912 ,  10168 , 10449 ,  10753 ,  11077 ,  11418 ,  11775 ,  12146 ,  12527 ,  12917 , 13313 };
const uint16_t moog6release[65] = { 19223 ,  19117 ,  19020 ,  18934 ,  18858 ,  18793 ,  18739 ,  18696 , 18664 ,  18644 ,  18634 ,  18636 ,  18648 ,  18671 ,  18703 ,  18745 , 18795 ,  18854 ,  18920 ,  18992 ,  19070 ,  19152 ,  19238 ,  19326 , 19416 ,  19505 ,  19594 ,  19680 ,  19762 ,  19840 ,  19911 ,  19974 , 20028 ,  20072 ,  20105 ,  20125 ,  20132 ,  20123 ,  20099 ,  20057 , 19999 ,  19921 ,  19825 ,  19709 ,  19574 ,  19418 ,  19241 ,  19045 , 18828 ,  18591 ,  18335 ,  18060 ,  17768 ,  17457 ,  17131 ,  16790 , 16435 ,  16068 ,  15691 ,  15305 ,  14912 ,  14514 ,  14114 ,  13712 , 13313 };
const uint16_t moog7attack[65] = { 20353 ,  20310 ,  20270 ,  20231 ,  20193 ,  20151 ,  20103 ,  20048 , 19982 ,  19903 ,  19810 ,  19700 ,  19572 ,  19425 ,  19258 ,  19072 , 18865 ,  18639 ,  18393 ,  18129 ,  17848 ,  17549 ,  17236 ,  16910 , 16571 ,  16223 ,  15866 ,  15503 ,  15135 ,  14765 ,  14395 ,  14026 , 13661 ,  13301 ,  12949 ,  12606 ,  12273 ,  11954 ,  11648 ,  11358 , 11085 ,  10830 ,  10595 ,  10380 ,  10186 ,  10014 ,   9866 ,   9740 , 9638 ,   9560 ,   9506 ,   9477 ,   9472 ,   9490 ,   9532 ,   9598 , 9686 ,   9797 ,   9929 ,  10081 ,  10254 ,  10446 ,  10655 ,  10881 , 11123 };
const uint16_t moog7release[65] = { 20321 ,  20362 ,  20407 ,  20455 ,  20505 ,  20557 ,  20609 ,  20662 , 20715 ,  20766 ,  20816 ,  20864 ,  20908 ,  20949 ,  20985 ,  21015 , 21040 ,  21058 ,  21069 ,  21072 ,  21066 ,  21050 ,  21025 ,  20990 , 20943 ,  20885 ,  20816 ,  20734 ,  20639 ,  20532 ,  20412 ,  20278 , 20131 ,  19971 ,  19797 ,  19610 ,  19410 ,  19197 ,  18972 ,  18734 , 18484 ,  18223 ,  17951 ,  17669 ,  17378 ,  17078 ,  16770 ,  16456 , 16135 ,  15809 ,  15480 ,  15147 ,  14813 ,  14478 ,  14144 ,  13812 , 13484 ,  13159 ,  12841 ,  12529 ,  12226 ,  11933 ,  11651 ,  11380 , 11123 };
const uint16_t moog8attack[65] = { 22736 ,  22717 ,  22692 ,  22659 ,  22617 ,  22566 ,  22504 ,  22430 , 22343 ,  22241 ,  22122 ,  21988 ,  21835 ,  21665 ,  21476 ,  21268 , 21042 ,  20797 ,  20534 ,  20253 ,  19955 ,  19640 ,  19311 ,  18967 , 18609 ,  18240 ,  17861 ,  17472 ,  17075 ,  16672 ,  16265 ,  15855 , 15443 ,  15031 ,  14620 ,  14213 ,  13811 ,  13415 ,  13027 ,  12647 , 12278 ,  11921 ,  11577 ,  11248 ,  10933 ,  10635 ,  10355 ,  10093 , 9849 ,   9626 ,   9423 ,   9241 ,   9080 ,   8942 ,   8825 ,   8731 , 8660 ,   8611 ,   8585 ,   8581 ,   8599 ,   8640 ,   8702 ,   8786 , 8890 };
const uint16_t moog8release[65] = { 22767 ,  22790 ,  22806 ,  22815 ,  22815 ,  22807 ,  22790 ,  22763 , 22726 ,  22679 ,  22621 ,  22552 ,  22471 ,  22379 ,  22275 ,  22158 , 22030 ,  21889 ,  21736 ,  21570 ,  21392 ,  21201 ,  20998 ,  20783 , 20555 ,  20316 ,  20066 ,  19804 ,  19532 ,  19250 ,  18957 ,  18656 , 18346 ,  18027 ,  17701 ,  17369 ,  17030 ,  16687 ,  16339 ,  15987 , 15633 ,  15277 ,  14920 ,  14563 ,  14208 ,  13855 ,  13504 ,  13158 , 12817 ,  12483 ,  12156 ,  11837 ,  11527 ,  11228 ,  10940 ,  10665 , 10402 ,  10155 ,   9922 ,   9705 ,   9505 ,   9323 ,   9160 ,   9015 , 8890 };
const uint16_t moog9attack[65] = { 23211 ,  23356 ,  23491 ,  23614 ,  23725 ,  23824 ,  23909 ,  23979 , 24033 ,  24070 ,  24088 ,  24088 ,  24069 ,  24029 ,  23968 ,  23885 , 23782 ,  23656 ,  23509 ,  23341 ,  23151 ,  22940 ,  22709 ,  22458 , 22187 ,  21898 ,  21592 ,  21269 ,  20930 ,  20577 ,  20210 ,  19831 , 19441 ,  19041 ,  18632 ,  18217 ,  17795 ,  17369 ,  16940 ,  16508 , 16077 ,  15646 ,  15217 ,  14791 ,  14371 ,  13955 ,  13547 ,  13148 , 12757 ,  12377 ,  12008 ,  11652 ,  11309 ,  10981 ,  10667 ,  10370 , 10089 ,   9825 ,   9579 ,   9352 ,   9143 ,   8954 ,   8784 ,   8635 , 8505 };
const uint16_t moog9release[65] = { 23600 ,  23429 ,  23246 ,  23052 ,  22846 ,  22629 ,  22401 ,  22163 , 21913 ,  21654 ,  21384 ,  21104 ,  20815 ,  20517 ,  20211 ,  19896 , 19573 ,  19243 ,  18906 ,  18563 ,  18215 ,  17861 ,  17503 ,  17142 , 16778 ,  16411 ,  16043 ,  15674 ,  15305 ,  14937 ,  14571 ,  14207 , 13846 ,  13489 ,  13137 ,  12791 ,  12451 ,  12119 ,  11794 ,  11479 , 11174 ,  10879 ,  10595 ,  10324 ,  10066 ,   9821 ,   9591 ,   9375 , 9176 ,   8993 ,   8826 ,   8677 ,   8546 ,   8434 ,   8340 ,   8266 , 8211 ,   8176 ,   8162 ,   8167 ,   8194 ,   8241 ,   8308 ,   8397 , 8505 };

const uint16_t moog9attack2[65] = { 13722 ,  12707 ,  10958 ,  12036 ,  12302 ,  11953 ,  12138 ,  12307 , 12301 ,  12374 ,  12473 ,  12535 ,  12604 ,  12682 ,  12754 ,  12825 , 12899 ,  12972 ,  13044 ,  13117 ,  13190 ,  13262 ,  13335 ,  13408 , 13481 ,  13553 ,  13626 ,  13699 ,  13772 ,  13844 ,  13917 ,  13990 , 14063 ,  14136 ,  14208 ,  14281 ,  14354 ,  14427 ,  14499 ,  14572 , 14645 ,  14718 ,  14790 ,  14863 ,  14936 ,  15009 ,  15081 ,  15154 , 15227 ,  15300 ,  15373 ,  15445 ,  15518 ,  15591 ,  15664 ,  15736 , 15809 ,  15882 ,  15955 ,  16027 ,  16100 ,  16173 ,  16246 ,  16318 , 16391  };
const uint16_t moog9release2[65] = { 13674 ,  20975 ,  20903 ,  20830 ,  20757 ,  20684 ,  20612 ,  20539 , 20466 ,  20393 ,  20320 ,  20248 ,  20175 ,  20102 ,  20029 ,  19957 , 19884 ,  19811 ,  19738 ,  19666 ,  19593 ,  19520 ,  19447 ,  19375 , 19302 ,  19229 ,  19156 ,  19083 ,  19011 ,  18938 ,  18865 ,  18792 , 18720 ,  18647 ,  18574 ,  18501 ,  18429 ,  18356 ,  18283 ,  18210 , 18138 ,  18065 ,  17992 ,  17919 ,  17847 ,  17774 ,  17701 ,  17628 , 17555 ,  17483 ,  17410 ,  17337 ,  17264 ,  17192 ,  17119 ,  17046 , 16973 ,  16901 ,  16828 ,  16755 ,  16682 ,  16610 ,  16537 ,  16464 , 16391  };
const uint16_t moog8attack2[65] = { 17119 ,   8161 ,  14448 ,  10228 ,  13085 ,  11480 ,  12468 ,  12119 , 12317 ,  12425 ,  12389 ,  12592 ,  12542 ,  12717 ,  12711 ,  12841 , 12875 ,  12972 ,  13030 ,  13111 ,  13180 ,  13254 ,  13327 ,  13399 , 13473 ,  13544 ,  13618 ,  13690 ,  13763 ,  13836 ,  13909 ,  13981 , 14054 ,  14127 ,  14200 ,  14273 ,  14345 ,  14418 ,  14491 ,  14564 , 14636 ,  14709 ,  14782 ,  14855 ,  14927 ,  15000 ,  15073 ,  15146 , 15218 ,  15291 ,  15364 ,  15437 ,  15510 ,  15582 ,  15655 ,  15728 , 15801 ,  15873 ,  15946 ,  16019 ,  16092 ,  16164 ,  16237 ,  16310 , 16383  };
const uint16_t moog8release2[65] = { 17071 ,  20967 ,  20894 ,  20821 ,  20749 ,  20676 ,  20603 ,  20530 , 20457 ,  20385 ,  20312 ,  20239 ,  20166 ,  20094 ,  20021 ,  19948 , 19875 ,  19803 ,  19730 ,  19657 ,  19584 ,  19512 ,  19439 ,  19366 , 19293 ,  19221 ,  19148 ,  19075 ,  19002 ,  18929 ,  18857 ,  18784 , 18711 ,  18638 ,  18566 ,  18493 ,  18420 ,  18347 ,  18275 ,  18202 , 18129 ,  18056 ,  17984 ,  17911 ,  17838 ,  17765 ,  17692 ,  17620 , 17547 ,  17474 ,  17401 ,  17329 ,  17256 ,  17183 ,  17110 ,  17038 , 16965 ,  16892 ,  16819 ,  16747 ,  16674 ,  16601 ,  16528 ,  16455 , 16383  };
const uint16_t moog7attack2[65] = { 19553 ,   9783 ,   8656 ,  14934 ,  12325 ,  10044 ,  13074 ,  12968 , 11312 ,  12450 ,  13003 ,  12152 ,  12438 ,  12964 ,  12655 ,  12659 , 13006 ,  12969 ,  12933 ,  13133 ,  13203 ,  13199 ,  13316 ,  13412 , 13444 ,  13525 ,  13618 ,  13675 ,  13744 ,  13829 ,  13897 ,  13965 , 14043 ,  14116 ,  14185 ,  14260 ,  14334 ,  14405 ,  14478 ,  14551 , 14623 ,  14696 ,  14769 ,  14842 ,  14914 ,  14987 ,  15060 ,  15133 , 15206 ,  15279 ,  15351 ,  15424 ,  15497 ,  15570 ,  15642 ,  15715 , 15788 ,  15861 ,  15933 ,  16006 ,  16079 ,  16152 ,  16224 ,  16297 , 16370  };
const uint16_t moog7release2[65] = { 19505 ,  20954 ,  20881 ,  20809 ,  20736 ,  20663 ,  20590 ,  20517 , 20445 ,  20372 ,  20299 ,  20226 ,  20154 ,  20081 ,  20008 ,  19935 , 19863 ,  19790 ,  19717 ,  19644 ,  19572 ,  19499 ,  19426 ,  19353 , 19280 ,  19208 ,  19135 ,  19062 ,  18989 ,  18917 ,  18844 ,  18771 , 18698 ,  18626 ,  18553 ,  18480 ,  18407 ,  18335 ,  18262 ,  18189 , 18116 ,  18044 ,  17971 ,  17898 ,  17825 ,  17752 ,  17680 ,  17607 , 17534 ,  17461 ,  17389 ,  17316 ,  17243 ,  17170 ,  17098 ,  17025 , 16952 ,  16879 ,  16807 ,  16734 ,  16661 ,  16588 ,  16515 ,  16443 , 16370  };
const uint16_t moog6attack2[65] = { 20585 ,  15420 ,   8051 ,   7469 ,  12607 ,  15579 ,  13361 ,  10237 , 10443 ,  12900 ,  14015 ,  12856 ,  11584 ,  11908 ,  13076 ,  13490 , 12931 ,  12454 ,  12723 ,  13288 ,  13454 ,  13214 ,  13070 ,  13266 , 13555 ,  13642 ,  13564 ,  13555 ,  13698 ,  13863 ,  13930 ,  13932 , 13976 ,  14086 ,  14197 ,  14262 ,  14302 ,  14366 ,  14457 ,  14546 , 14612 ,  14671 ,  14741 ,  14823 ,  14902 ,  14971 ,  15038 ,  15110 , 15187 ,  15262 ,  15333 ,  15403 ,  15476 ,  15551 ,  15625 ,  15696 , 15768 ,  15841 ,  15915 ,  15988 ,  16060 ,  16132 ,  16205 ,  16278 , 16351  };
const uint16_t moog6release2[65] = { 20537 ,  20935 ,  20862 ,  20789 ,  20717 ,  20644 ,  20571 ,  20498 , 20426 ,  20353 ,  20280 ,  20207 ,  20135 ,  20062 ,  19989 ,  19916 , 19843 ,  19771 ,  19698 ,  19625 ,  19552 ,  19480 ,  19407 ,  19334 , 19261 ,  19189 ,  19116 ,  19043 ,  18970 ,  18898 ,  18825 ,  18752 , 18679 ,  18606 ,  18534 ,  18461 ,  18388 ,  18315 ,  18243 ,  18170 , 18097 ,  18024 ,  17952 ,  17879 ,  17806 ,  17733 ,  17661 ,  17588 , 17515 ,  17442 ,  17370 ,  17297 ,  17224 ,  17151 ,  17078 ,  17006 , 16933 ,  16860 ,  16787 ,  16715 ,  16642 ,  16569 ,  16496 ,  16424 , 16351  };
const uint16_t moog5attack2[65] = { 20901 ,  19021 ,  14108 ,   8861 ,   6550 ,   8110 ,  11858 ,  15053 , 15828 ,  14206 ,  11719 ,  10150 ,  10361 ,  11920 ,  13630 ,  14427 , 14029 ,  12964 ,  12079 ,  11944 ,  12547 ,  13409 ,  13984 ,  14008 , 13619 ,  13188 ,  13041 ,  13263 ,  13687 ,  14054 ,  14188 ,  14095 , 13924 ,  13844 ,  13934 ,  14150 ,  14378 ,  14517 ,  14543 ,  14506 , 14489 ,  14544 ,  14668 ,  14816 ,  14936 ,  15003 ,  15031 ,  15056 , 15109 ,  15196 ,  15303 ,  15403 ,  15481 ,  15538 ,  15587 ,  15646 , 15721 ,  15807 ,  15895 ,  15973 ,  16042 ,  16104 ,  16168 ,  16239 , 16317  };
const uint16_t moog5release2[65] = { 20853 ,  20906 ,  20833 ,  20761 ,  20688 ,  20615 ,  20542 ,  20470 , 20397 ,  20324 ,  20251 ,  20179 ,  20106 ,  20033 ,  19960 ,  19887 , 19815 ,  19742 ,  19669 ,  19596 ,  19524 ,  19451 ,  19378 ,  19305 , 19233 ,  19160 ,  19087 ,  19014 ,  18941 ,  18869 ,  18796 ,  18723 , 18651 ,  18578 ,  18505 ,  18432 ,  18359 ,  18286 ,  18214 ,  18142 , 18069 ,  17996 ,  17922 ,  17849 ,  17777 ,  17705 ,  17633 ,  17560 , 17487 ,  17413 ,  17339 ,  17266 ,  17194 ,  17124 ,  17053 ,  16980 , 16904 ,  16828 ,  16754 ,  16683 ,  16615 ,  16546 ,  16474 ,  16397 , 16317  };
const uint16_t moog4attack2[65] = { 20953 ,  20437 ,  18473 ,  15119 ,  11316 ,   8217 ,   6671 ,   6960 , 8775 ,  11391 ,  13935 ,  15674 ,  16213 ,  15571 ,  14120 ,  12427 , 11054 ,  10395 ,  10575 ,  11450 ,  12686 ,  13885 ,  14714 ,  14993 , 14734 ,  14108 ,  13374 ,  12790 ,  12532 ,  12658 ,  13100 ,  13705 , 14291 ,  14707 ,  14871 ,  14790 ,  14542 ,  14247 ,  14020 ,  13944 , 14043 ,  14286 ,  14602 ,  14909 ,  15137 ,  15250 ,  15252 ,  15177 , 15082 ,  15019 ,  15024 ,  15110 ,  15261 ,  15445 ,  15625 ,  15768 , 15858 ,  15898 ,  15903 ,  15899 ,  15910 ,  15953 ,  16032 ,  16140 , 16264  };
const uint16_t moog4release2[65] = { 20904 ,  20862 ,  20790 ,  20717 ,  20645 ,  20573 ,  20501 ,  20428 , 20354 ,  20281 ,  20207 ,  20133 ,  20061 ,  19988 ,  19917 ,  19845 , 19774 ,  19702 ,  19629 ,  19555 ,  19480 ,  19405 ,  19331 ,  19258 , 19186 ,  19116 ,  19046 ,  18977 ,  18905 ,  18832 ,  18756 ,  18679 , 18601 ,  18525 ,  18452 ,  18382 ,  18315 ,  18249 ,  18183 ,  18113 , 18039 ,  17960 ,  17877 ,  17793 ,  17713 ,  17639 ,  17572 ,  17512 , 17456 ,  17397 ,  17331 ,  17255 ,  17168 ,  17073 ,  16977 ,  16887 , 16812 ,  16753 ,  16708 ,  16670 ,  16628 ,  16571 ,  16490 ,  16386 , 16264  };
const uint16_t moog3attack2[65] = { 20908 ,  20833 ,  20267 ,  18982 ,  17007 ,  14574 ,  12023 ,   9711 , 7942 ,   6922 ,   6736 ,   7344 ,   8600 ,  10282 ,  12126 ,  13873 , 15297 ,  16241 ,  16626 ,  16461 ,  15828 ,  14867 ,  13752 ,  12662 , 11757 ,  11156 ,  10924 ,  11071 ,  11552 ,  12281 ,  13142 ,  14015 , 14788 ,  15371 ,  15712 ,  15795 ,  15642 ,  15306 ,  14859 ,  14386 , 13963 ,  13655 ,  13505 ,  13529 ,  13719 ,  14042 ,  14453 ,  14896 , 15316 ,  15668 ,  15919 ,  16053 ,  16073 ,  15995 ,  15850 ,  15675 , 15506 ,  15376 ,  15311 ,  15323 ,  15414 ,  15574 ,  15784 ,  16022 , 16262  };
const uint16_t moog3release2[65] = { 20852 ,  20780 ,  20704 ,  20630 ,  20559 ,  20493 ,  20428 ,  20366 , 20304 ,  20241 ,  20175 ,  20105 ,  20030 ,  19950 ,  19865 ,  19777 , 19688 ,  19601 ,  19517 ,  19438 ,  19367 ,  19304 ,  19247 ,  19196 , 19147 ,  19097 ,  19042 ,  18980 ,  18907 ,  18824 ,  18729 ,  18627 , 18519 ,  18412 ,  18310 ,  18218 ,  18141 ,  18081 ,  18036 ,  18005 , 17983 ,  17962 ,  17935 ,  17894 ,  17833 ,  17749 ,  17639 ,  17509 , 17364 ,  17214 ,  17070 ,  16944 ,  16846 ,  16782 ,  16755 ,  16761 , 16791 ,  16832 ,  16868 ,  16882 ,  16857 ,  16784 ,  16657 ,  16480 , 16262  };
const uint16_t moog2attack2[65] = { 20947 ,  20955 ,  20820 ,  20435 ,  19732 ,  18698 ,  17369 ,  15817 , 14141 ,  12447 ,  10843 ,   9427 ,   8282 ,   7467 ,   7017 ,   6945 , 7235 ,   7853 ,   8743 ,   9837 ,  11059 ,  12328 ,  13564 ,  14698 , 15667 ,  16426 ,  16944 ,  17208 ,  17221 ,  17002 ,  16584 ,  16011 , 15332 ,  14602 ,  13874 ,  13199 ,  12622 ,  12176 ,  11887 ,  11768 , 11821 ,  12036 ,  12395 ,  12870 ,  13429 ,  14036 ,  14655 ,  15249 , 15789 ,  16246 ,  16603 ,  16848 ,  16976 ,  16991 ,  16904 ,  16731 , 16493 ,  16213 ,  15917 ,  15629 ,  15370 ,  15161 ,  15016 ,  14944 , 14951  };
const uint16_t moog2release2[65] = { 20920 ,  20863 ,  20794 ,  20714 ,  20623 ,  20521 ,  20410 ,  20292 , 20168 ,  20044 ,  19920 ,  19802 ,  19693 ,  19595 ,  19512 ,  19443 , 19392 ,  19356 ,  19335 ,  19327 ,  19326 ,  19330 ,  19334 ,  19331 , 19318 ,  19289 ,  19240 ,  19169 ,  19074 ,  18954 ,  18812 ,  18651 , 18475 ,  18290 ,  18104 ,  17923 ,  17755 ,  17609 ,  17489 ,  17402 , 17349 ,  17332 ,  17350 ,  17399 ,  17472 ,  17562 ,  17657 ,  17749 , 17824 ,  17873 ,  17885 ,  17852 ,  17769 ,  17632 ,  17443 ,  17206 , 16930 ,  16624 ,  16304 ,  15984 ,  15681 ,  15412 ,  15193 ,  15036 , 14951  };
const uint16_t moog1attack2[65] = { 20345 ,  20343 ,  20322 ,  20245 ,  20079 ,  19798 ,  19386 ,  18837 , 18157 ,  17358 ,  16460 ,  15489 ,  14471 ,  13438 ,  12418 ,  11443 , 10538 ,   9729 ,   9037 ,   8478 ,   8065 ,   7806 ,   7704 ,   7757 , 7960 ,   8302 ,   8771 ,   9350 ,  10020 ,  10760 ,  11548 ,  12362 , 13180 ,  13980 ,  14742 ,  15449 ,  16085 ,  16636 ,  17092 ,  17447 , 17696 ,  17839 ,  17879 ,  17820 ,  17670 ,  17440 ,  17141 ,  16787 , 16392 ,  15971 ,  15540 ,  15113 ,  14704 ,  14326 ,  13991 ,  13708 , 13486 ,  13331 ,  13245 ,  13232 ,  13289 ,  13415 ,  13606 ,  13855 , 14155  };
const uint16_t moog1release2[65] = { 20381 ,  20395 ,  20418 ,  20447 ,  20479 ,  20511 ,  20540 ,  20564 , 20578 ,  20581 ,  20569 ,  20539 ,  20490 ,  20421 ,  20330 ,  20216 , 20081 ,  19924 ,  19748 ,  19555 ,  19348 ,  19130 ,  18904 ,  18676 , 18449 ,  18228 ,  18018 ,  17824 ,  17649 ,  17498 ,  17374 ,  17280 , 17217 ,  17186 ,  17189 ,  17223 ,  17287 ,  17379 ,  17495 ,  17629 , 17778 ,  17934 ,  18091 ,  18243 ,  18382 ,  18503 ,  18597 ,  18660 , 18685 ,  18669 ,  18607 ,  18498 ,  18341 ,  18135 ,  17883 ,  17588 , 17255 ,  16890 ,  16500 ,  16094 ,  15681 ,  15270 ,  14872 ,  14497 , 14155  };


extern Family familyArray[8];
extern uint8_t familyIndicator;
enum speedTypes speed;
enum loopTypes loop;
enum trigModeTypes trigMode;
enum sampleHoldModeTypes sampleHoldMode;
int trig;
uint8_t phaseState;
uint8_t lastAttackFlag;
uint8_t lastReleaseFlag;
uint8_t intoattackfroml;
uint8_t intoreleasefroml;
uint8_t intoattackfromr;
uint8_t intoreleasefromr;
uint8_t pintimer;
uint16_t sampleHoldTimer;
int benchmark;
int lastcount;
int out;
extern uint32_t ADCReadings1[4];
extern uint32_t ADCReadings2[2];
extern uint32_t ADCReadings3[1];

//define our wavetable family as two arrays of 9 wavetables (defined in tables.h), one for attack, one for release





/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_DMA_Init(void);
static void MX_ADC1_Init(void);
static void MX_ADC2_Init(void);
static void MX_ADC3_Init(void);
static void MX_DAC_Init(void);
static void MX_TIM1_Init(void);
static void MX_TSC_Init(void);
static void MX_TIM2_Init(void);
static void MX_TIM6_Init(void);
static void MX_TIM3_Init(void);

void HAL_TIM_MspPostInit(TIM_HandleTypeDef *htim);
                                

/* USER CODE BEGIN PFP */
/* Private function prototypes -----------------------------------------------*/
void ReadPins(void);
void ProcessSensors(void);
void ChangeMode(int);
void ShowMode(uint8_t);
void ClearRGB(void);
void ClearLEDs(void);
/* USER CODE END PFP */

/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

int main(void)
{

  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration----------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_DMA_Init();
  MX_ADC1_Init();
  MX_ADC2_Init();
  MX_ADC3_Init();
  MX_DAC_Init();
  MX_TIM1_Init();
  MX_TSC_Init();
  MX_TIM2_Init();
  MX_TIM6_Init();
  MX_TIM3_Init();

  /* USER CODE BEGIN 2 */
  //define our wavetable family as two arrays of 9 wavetables (defined in tables.h), one for attack, one for release

  	const uint16_t *perlinAttackFamily[9] = {perlin6_1, perlin6_2, perlin6_3, perlin6_4, perlin6_5, perlin6_6, perlin6_7, perlin6_8, perlin6_8};
    const uint16_t *perlinReleaseFamily[9] = {perlin6_1, perlin6_2, perlin6_3, perlin6_4, perlin6_5, perlin6_6, perlin6_7, perlin6_8, perlin6_8};
    const uint16_t *sinefoldAttackFamily[9] = {sinefold_ctr_1, sinefold_ctr_2, sinefold_ctr_3, sinefold_ctr_4, sinefold_ctr_5, sinefold_ctr_6, sinefold_ctr_7, sinefold_ctr_8, sinefold_ctr_9};
    const uint16_t *sinefoldReleaseFamily[9] = {sinefold_ctr_1, sinefold_ctr_2, sinefold_ctr_3, sinefold_ctr_4, sinefold_ctr_5, sinefold_ctr_6, sinefold_ctr_7, sinefold_ctr_8, sinefold_ctr_9};
    const uint16_t *bounceAttackFamily[9] = {bounce1, bounce2, bounce3, bounce4, bounce5, bounce6, bounce7, bounce8};
    const uint16_t *bounceReleaseFamily[9] = {bounce1, bounce2, bounce3, bounce4, bounce5, bounce6, bounce7, bounce8};
    const uint16_t *trifoldAttackFamily[9] = {trifold_1, trifold_2, trifold_3, trifold_4, trifold_5, trifold_6, trifold_7, trifold_8, trifold_9};
    const uint16_t *trifoldReleaseFamily[9] = {trifold_1, trifold_2, trifold_3, trifold_4, trifold_5, trifold_6, trifold_7, trifold_8, trifold_9};
    const uint16_t *trioddAttackFamily[9] = {triodd_1, triodd_2, triodd_3, triodd_4, triodd_5, triodd_6, triodd_7, triodd_8, triodd_9};
    const uint16_t *trioddReleaseFamily[9] = {triodd_1, triodd_2, triodd_3, triodd_4, triodd_5, triodd_6, triodd_7, triodd_8, triodd_9};
    const uint16_t *trifudgeAttackFamily[9] = {trifudge_1, trifudge_2, trifudge_3, trifudge_4, trifudge_5, trifudge_6, trifudge_7, trifudge_8, trifudge_9};
    const uint16_t *trifudgeReleaseFamily[9] = {trifudge_1, trifudge_2, trifudge_3, trifudge_4, trifudge_5, trifudge_6, trifudge_7, trifudge_8, trifudge_9};
    const uint16_t *moog1AttackFamily[9] = {moog1attack, moog2attack, moog3attack, moog5attack, moog6attack, moog7attack, moog8attack, moog9attack, moog9attack};
    const uint16_t *moog1ReleaseFamily[9] = {moog1release, moog2release, moog3release, moog5release, moog6release, moog7release, moog8release, moog9release, moog9release};
    const uint16_t *moog2AttackFamily[9] = {moog1attack2, moog2attack2, moog3attack2, moog4attack2, moog5attack2, moog6attack2, moog7attack2, moog8attack2, moog9attack2};
    const uint16_t *moog2ReleaseFamily[9] = {moog1release2, moog2release2, moog3release2, moog4release2, moog5release2, moog6release2, moog7release2, moog8release2, moog9release2};

    perlin.attackFamily = perlinAttackFamily;
    perlin.releaseFamily = perlinReleaseFamily;
    perlin.tableLength = 64;
    perlin.familySize = 9;
    familyArray[0] = perlin;

    sineFold.attackFamily = sinefoldAttackFamily;
    sineFold.releaseFamily= sinefoldReleaseFamily;
    sineFold.tableLength = 64;
    sineFold.familySize = 9;
    familyArray[1] = sineFold;

    bounce.attackFamily= bounceAttackFamily;
    bounce.releaseFamily = bounceReleaseFamily;
    bounce.tableLength = 64;
    bounce.familySize = 9;
    familyArray[2] = bounce;

    triFold.attackFamily = trifoldAttackFamily;
    triFold.releaseFamily = trifoldReleaseFamily;
    triFold.tableLength = 64;
    triFold.familySize = 9;
    familyArray[3] = triFold;

    triOdd.attackFamily = trioddAttackFamily;
    triOdd.releaseFamily = trioddReleaseFamily;
    triOdd.tableLength = 64;
    triOdd.familySize = 9;
    familyArray[4] = triOdd;

    triFudge.attackFamily = trifudgeAttackFamily;
    triFudge.releaseFamily = trifudgeReleaseFamily;
    triFudge.tableLength = 64;
    triFudge.familySize = 9;
    familyArray[5] = triFudge;

    moog1.attackFamily = moog1AttackFamily;
    moog1.releaseFamily = moog1ReleaseFamily;
    moog1.tableLength = 64;
    moog1.familySize = 9;
    familyArray[6] = moog1;

    moog2.attackFamily = moog2AttackFamily;
    moog2.releaseFamily = moog2ReleaseFamily;
    moog2.tableLength = 64;
    moog2.familySize = 9;
    familyArray[7] = moog2;

	span = familyArray[0].tableLength << 16;
	spanx2 = familyArray[0].tableLength << 17;





      HAL_ADC_Start_DMA(&hadc1, ADCReadings1, 4);
      HAL_ADC_Start_DMA(&hadc2, ADCReadings2, 2);
      HAL_ADC_Start_DMA(&hadc3, ADCReadings3, 1);
      HAL_TIM_IC_Start_IT(&htim2, TIM_CHANNEL_1);
      HAL_TIM_Base_Start(&htim1);
      HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_1);
      HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_2);
      HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3);
      HAL_DAC_Start(&hdac, DAC_CHANNEL_1);
      HAL_DAC_Start(&hdac, DAC_CHANNEL_2);
      HAL_DAC_Start_DMA(&hdac, DAC_CHANNEL_1, (uint32_t*)dacbuffer1, 1, DAC_ALIGN_12B_R);
      HAL_DAC_Start_DMA(&hdac, DAC_CHANNEL_2, (uint32_t*)dacbuffer2, 1, DAC_ALIGN_12B_R);



      tsl_user_Init();
      HAL_TIM_Base_Start_IT(&htim6);



  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {

		tsl_status = tsl_user_Exec();

  	  	if (tsl_status != TSL_USER_STATUS_BUSY) {
	 	 ReadPins();
	 	 if (pindownlastcycle > modechanged) {
	 		 		 	 ChangeMode(modeflag);
	 		 		 	 switch (modeflag) {
	 		 		 	 case 1: ShowMode(speed);
	 		 		 	 	 	 HAL_Delay(500);
	 		 		 	 	 	 ClearLEDs();
	 		 		 	 	 	 break;
	 		 		 	 case 2: ShowMode(trigMode);
		 		 	 	 	 	 HAL_Delay(500);
		 		 	 	 	 	 ClearLEDs();
	 		 		 	 	 	 break;
	 		 		 	 case 3: ShowMode(loop);
		 		 	 	 	 	 HAL_Delay(500);
		 		 	 	 	 	 ClearLEDs();
	 		 		 	 	 	 break;
	 		 		 	 case 4: ShowMode(sampleHoldMode);
 		 	 	 	 	 	 	 HAL_Delay(500);
 		 	 	 	 	 	 	 ClearLEDs();
	 		 		 	 	 	 break;
	 		 		 	 case 5: ShowMode(familyIndicator);
 		 	 	 	 	 	 	 HAL_Delay(500);
 		 	 	 	 	 	 	 ClearLEDs();
	 		 		 	 	 	 break;
	 		 		 	 case 6: ShowMode(familyIndicator);
 		 	 	 	 	 	 	 HAL_Delay(500);
 		 	 	 	 	 	 	 ClearLEDs();
	 		 		 	 	 	 break;
	 		 		 	 }

	 	 	 }

	 	}


	 	 if (phaseState == 1 && modechanged == 0) {
	 		 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, out);
	 		 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_2, 0);} //sets the PWM duty cycle (Capture Compare Value)
	 	 if (phaseState == 2 && modechanged == 0) {
	 		 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_2, out);
	 		 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 0);
	 	 } //sets the PWM duty cycle (Capture Compare Value)
	 	 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_3, ADCReadings3[0]);
	 	//__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_2, 2000);
	 	//__HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 2000);//sets the PWM duty cycle (Capture Compare Value)



	     	//				uhTSCAcquisitionValue3 if acquisition successful*/
	 	 //SetFlags(); /*Sets flag1, flag2, or flag3 per the unique value combos indicating a touch in the corresponding
	      //	 	 	 zone*/
	      //


  /* USER CODE END WHILE */

  /* USER CODE BEGIN 3 */

  }
  /* USER CODE END 3 */

}

/** System Clock Configuration
*/
void SystemClock_Config(void)
{

  RCC_OscInitTypeDef RCC_OscInitStruct;
  RCC_ClkInitTypeDef RCC_ClkInitStruct;
  RCC_PeriphCLKInitTypeDef PeriphClkInit;

    /**Initializes the CPU, AHB and APB busses clocks 
    */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = 16;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSI;
  RCC_OscInitStruct.PLL.PLLMUL = RCC_PLL_MUL16;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Initializes the CPU, AHB and APB busses clocks 
    */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV2;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_2) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  PeriphClkInit.PeriphClockSelection = RCC_PERIPHCLK_TIM1|RCC_PERIPHCLK_ADC12
                              |RCC_PERIPHCLK_ADC34;
  PeriphClkInit.Adc12ClockSelection = RCC_ADC12PLLCLK_DIV16;
  PeriphClkInit.Adc34ClockSelection = RCC_ADC34PLLCLK_DIV16;
  PeriphClkInit.Tim1ClockSelection = RCC_TIM1CLK_HCLK;
  if (HAL_RCCEx_PeriphCLKConfig(&PeriphClkInit) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure the Systick interrupt time 
    */
  HAL_SYSTICK_Config(HAL_RCC_GetHCLKFreq()/1000);

    /**Configure the Systick 
    */
  HAL_SYSTICK_CLKSourceConfig(SYSTICK_CLKSOURCE_HCLK);

  /* SysTick_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(SysTick_IRQn, 0, 0);
}

/* ADC1 init function */
static void MX_ADC1_Init(void)
{

  ADC_MultiModeTypeDef multimode;
  ADC_ChannelConfTypeDef sConfig;

    /**Common config 
    */
  hadc1.Instance = ADC1;
  hadc1.Init.ClockPrescaler = ADC_CLOCK_ASYNC_DIV1;
  hadc1.Init.Resolution = ADC_RESOLUTION_12B;
  hadc1.Init.ScanConvMode = ADC_SCAN_ENABLE;
  hadc1.Init.ContinuousConvMode = ENABLE;
  hadc1.Init.DiscontinuousConvMode = DISABLE;
  hadc1.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
  hadc1.Init.ExternalTrigConv = ADC_SOFTWARE_START;
  hadc1.Init.DataAlign = ADC_DATAALIGN_RIGHT;
  hadc1.Init.NbrOfConversion = 4;
  hadc1.Init.DMAContinuousRequests = ENABLE;
  hadc1.Init.EOCSelection = ADC_EOC_SEQ_CONV;
  hadc1.Init.LowPowerAutoWait = DISABLE;
  hadc1.Init.Overrun = ADC_OVR_DATA_OVERWRITTEN;
  if (HAL_ADC_Init(&hadc1) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure the ADC multi-mode 
    */
  multimode.Mode = ADC_MODE_INDEPENDENT;
  if (HAL_ADCEx_MultiModeConfigChannel(&hadc1, &multimode) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_1;
  sConfig.Rank = 1;
  sConfig.SingleDiff = ADC_SINGLE_ENDED;
  sConfig.SamplingTime = ADC_SAMPLETIME_181CYCLES_5;
  sConfig.OffsetNumber = ADC_OFFSET_NONE;
  sConfig.Offset = 0;
  if (HAL_ADC_ConfigChannel(&hadc1, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_2;
  sConfig.Rank = 2;
  if (HAL_ADC_ConfigChannel(&hadc1, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_3;
  sConfig.Rank = 3;
  if (HAL_ADC_ConfigChannel(&hadc1, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_4;
  sConfig.Rank = 4;
  if (HAL_ADC_ConfigChannel(&hadc1, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* ADC2 init function */
static void MX_ADC2_Init(void)
{

  ADC_ChannelConfTypeDef sConfig;

    /**Common config 
    */
  hadc2.Instance = ADC2;
  hadc2.Init.ClockPrescaler = ADC_CLOCK_ASYNC_DIV1;
  hadc2.Init.Resolution = ADC_RESOLUTION_12B;
  hadc2.Init.ScanConvMode = ADC_SCAN_ENABLE;
  hadc2.Init.ContinuousConvMode = ENABLE;
  hadc2.Init.DiscontinuousConvMode = DISABLE;
  hadc2.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
  hadc2.Init.ExternalTrigConv = ADC_SOFTWARE_START;
  hadc2.Init.DataAlign = ADC_DATAALIGN_RIGHT;
  hadc2.Init.NbrOfConversion = 2;
  hadc2.Init.DMAContinuousRequests = ENABLE;
  hadc2.Init.EOCSelection = ADC_EOC_SEQ_CONV;
  hadc2.Init.LowPowerAutoWait = DISABLE;
  hadc2.Init.Overrun = ADC_OVR_DATA_OVERWRITTEN;
  if (HAL_ADC_Init(&hadc2) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_3;
  sConfig.Rank = 1;
  sConfig.SingleDiff = ADC_SINGLE_ENDED;
  sConfig.SamplingTime = ADC_SAMPLETIME_61CYCLES_5;
  sConfig.OffsetNumber = ADC_OFFSET_NONE;
  sConfig.Offset = 0;
  if (HAL_ADC_ConfigChannel(&hadc2, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_4;
  sConfig.Rank = 2;
  sConfig.OffsetNumber = ADC_OFFSET_1;
  if (HAL_ADC_ConfigChannel(&hadc2, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* ADC3 init function */
static void MX_ADC3_Init(void)
{

  ADC_MultiModeTypeDef multimode;
  ADC_ChannelConfTypeDef sConfig;

    /**Common config 
    */
  hadc3.Instance = ADC3;
  hadc3.Init.ClockPrescaler = ADC_CLOCK_ASYNC_DIV1;
  hadc3.Init.Resolution = ADC_RESOLUTION_12B;
  hadc3.Init.ScanConvMode = ADC_SCAN_DISABLE;
  hadc3.Init.ContinuousConvMode = ENABLE;
  hadc3.Init.DiscontinuousConvMode = DISABLE;
  hadc3.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
  hadc3.Init.ExternalTrigConv = ADC_SOFTWARE_START;
  hadc3.Init.DataAlign = ADC_DATAALIGN_RIGHT;
  hadc3.Init.NbrOfConversion = 1;
  hadc3.Init.DMAContinuousRequests = ENABLE;
  hadc3.Init.EOCSelection = ADC_EOC_SINGLE_CONV;
  hadc3.Init.LowPowerAutoWait = DISABLE;
  hadc3.Init.Overrun = ADC_OVR_DATA_OVERWRITTEN;
  if (HAL_ADC_Init(&hadc3) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure the ADC multi-mode 
    */
  multimode.Mode = ADC_MODE_INDEPENDENT;
  if (HAL_ADCEx_MultiModeConfigChannel(&hadc3, &multimode) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**Configure Regular Channel 
    */
  sConfig.Channel = ADC_CHANNEL_12;
  sConfig.Rank = 1;
  sConfig.SingleDiff = ADC_SINGLE_ENDED;
  sConfig.SamplingTime = ADC_SAMPLETIME_61CYCLES_5;
  sConfig.OffsetNumber = ADC_OFFSET_NONE;
  sConfig.Offset = 0;
  if (HAL_ADC_ConfigChannel(&hadc3, &sConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* DAC init function */
static void MX_DAC_Init(void)
{

  DAC_ChannelConfTypeDef sConfig;

    /**DAC Initialization 
    */
  hdac.Instance = DAC;
  if (HAL_DAC_Init(&hdac) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**DAC channel OUT1 config 
    */
  sConfig.DAC_Trigger = DAC_TRIGGER_T6_TRGO;
  sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_DISABLE;
  if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_1) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

    /**DAC channel OUT2 config 
    */
  if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_2) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* TIM1 init function */
static void MX_TIM1_Init(void)
{

  TIM_MasterConfigTypeDef sMasterConfig;
  TIM_OC_InitTypeDef sConfigOC;
  TIM_BreakDeadTimeConfigTypeDef sBreakDeadTimeConfig;

  htim1.Instance = TIM1;
  htim1.Init.Prescaler = 10-1;
  htim1.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim1.Init.Period = 4095;
  htim1.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim1.Init.RepetitionCounter = 0;
  htim1.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_PWM_Init(&htim1) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterOutputTrigger2 = TIM_TRGO2_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim1, &sMasterConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  sConfigOC.OCMode = TIM_OCMODE_PWM1;
  sConfigOC.Pulse = 0;
  sConfigOC.OCPolarity = TIM_OCPOLARITY_HIGH;
  sConfigOC.OCNPolarity = TIM_OCNPOLARITY_HIGH;
  sConfigOC.OCFastMode = TIM_OCFAST_DISABLE;
  sConfigOC.OCIdleState = TIM_OCIDLESTATE_RESET;
  sConfigOC.OCNIdleState = TIM_OCNIDLESTATE_RESET;
  if (HAL_TIM_PWM_ConfigChannel(&htim1, &sConfigOC, TIM_CHANNEL_1) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  if (HAL_TIM_PWM_ConfigChannel(&htim1, &sConfigOC, TIM_CHANNEL_2) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  if (HAL_TIM_PWM_ConfigChannel(&htim1, &sConfigOC, TIM_CHANNEL_3) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  sBreakDeadTimeConfig.OffStateRunMode = TIM_OSSR_DISABLE;
  sBreakDeadTimeConfig.OffStateIDLEMode = TIM_OSSI_DISABLE;
  sBreakDeadTimeConfig.LockLevel = TIM_LOCKLEVEL_OFF;
  sBreakDeadTimeConfig.DeadTime = 0;
  sBreakDeadTimeConfig.BreakState = TIM_BREAK_DISABLE;
  sBreakDeadTimeConfig.BreakPolarity = TIM_BREAKPOLARITY_HIGH;
  sBreakDeadTimeConfig.BreakFilter = 0;
  sBreakDeadTimeConfig.Break2State = TIM_BREAK2_DISABLE;
  sBreakDeadTimeConfig.Break2Polarity = TIM_BREAK2POLARITY_HIGH;
  sBreakDeadTimeConfig.Break2Filter = 0;
  sBreakDeadTimeConfig.AutomaticOutput = TIM_AUTOMATICOUTPUT_DISABLE;
  if (HAL_TIMEx_ConfigBreakDeadTime(&htim1, &sBreakDeadTimeConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  HAL_TIM_MspPostInit(&htim1);

}

/* TIM2 init function */
static void MX_TIM2_Init(void)
{

  TIM_MasterConfigTypeDef sMasterConfig;
  TIM_IC_InitTypeDef sConfigIC;

  htim2.Instance = TIM2;
  htim2.Init.Prescaler = 0;
  htim2.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim2.Init.Period = 0;
  htim2.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim2.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_IC_Init(&htim2) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim2, &sMasterConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  sConfigIC.ICPolarity = TIM_INPUTCHANNELPOLARITY_BOTHEDGE;
  sConfigIC.ICSelection = TIM_ICSELECTION_DIRECTTI;
  sConfigIC.ICPrescaler = TIM_ICPSC_DIV1;
  sConfigIC.ICFilter = 0;
  if (HAL_TIM_IC_ConfigChannel(&htim2, &sConfigIC, TIM_CHANNEL_1) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* TIM3 init function */
static void MX_TIM3_Init(void)
{

  htim3.Instance = TIM3;
  htim3.Init.Prescaler = 0;
  htim3.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim3.Init.Period = 0;
  htim3.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;
  htim3.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_OnePulse_Init(&htim3, TIM_OPMODE_SINGLE) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* TIM6 init function */
static void MX_TIM6_Init(void)
{

  TIM_MasterConfigTypeDef sMasterConfig;

  htim6.Instance = TIM6;
  htim6.Init.Prescaler = 1-1;
  htim6.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim6.Init.Period = 2000;
  htim6.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim6) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

  sMasterConfig.MasterOutputTrigger = TIM_TRGO_UPDATE;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim6, &sMasterConfig) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/* TSC init function */
static void MX_TSC_Init(void)
{

    /**Configure the TSC peripheral 
    */
  htsc.Instance = TSC;
  htsc.Init.CTPulseHighLength = TSC_CTPH_2CYCLES;
  htsc.Init.CTPulseLowLength = TSC_CTPL_2CYCLES;
  htsc.Init.SpreadSpectrum = DISABLE;
  htsc.Init.SpreadSpectrumDeviation = 1;
  htsc.Init.SpreadSpectrumPrescaler = TSC_SS_PRESC_DIV1;
  htsc.Init.PulseGeneratorPrescaler = TSC_PG_PRESC_DIV32;
  htsc.Init.MaxCountValue = TSC_MCV_16383;
  htsc.Init.IODefaultMode = TSC_IODEF_OUT_PP_LOW;
  htsc.Init.SynchroPinPolarity = TSC_SYNC_POLARITY_FALLING;
  htsc.Init.AcquisitionMode = TSC_ACQ_MODE_NORMAL;
  htsc.Init.MaxCountInterrupt = DISABLE;
  htsc.Init.ChannelIOs = TSC_GROUP5_IO1|TSC_GROUP5_IO2|TSC_GROUP5_IO3|TSC_GROUP6_IO2
                    |TSC_GROUP6_IO3|TSC_GROUP6_IO4;
  htsc.Init.ShieldIOs = TSC_GROUP3_IO4;
  htsc.Init.SamplingIOs = TSC_GROUP3_IO3|TSC_GROUP5_IO4|TSC_GROUP6_IO1;
  if (HAL_TSC_Init(&htsc) != HAL_OK)
  {
    _Error_Handler(__FILE__, __LINE__);
  }

}

/** 
  * Enable DMA controller clock
  */
static void MX_DMA_Init(void) 
{
  /* DMA controller clock enable */
  __HAL_RCC_DMA1_CLK_ENABLE();
  __HAL_RCC_DMA2_CLK_ENABLE();

  /* DMA interrupt init */
  /* DMA1_Channel1_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA1_Channel1_IRQn, 2, 1);
  HAL_NVIC_EnableIRQ(DMA1_Channel1_IRQn);
  /* DMA1_Channel3_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA1_Channel3_IRQn, 0, 0);
  HAL_NVIC_EnableIRQ(DMA1_Channel3_IRQn);
  /* DMA1_Channel4_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA1_Channel4_IRQn, 0, 0);
  HAL_NVIC_EnableIRQ(DMA1_Channel4_IRQn);
  /* DMA2_Channel1_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA2_Channel1_IRQn, 3, 0);
  HAL_NVIC_EnableIRQ(DMA2_Channel1_IRQn);
  /* DMA2_Channel5_IRQn interrupt configuration */
  HAL_NVIC_SetPriority(DMA2_Channel5_IRQn, 2, 0);
  HAL_NVIC_EnableIRQ(DMA2_Channel5_IRQn);

}

/** Configure pins as 
        * Analog 
        * Input 
        * Output
        * EVENT_OUT
        * EXTI
*/
static void MX_GPIO_Init(void)
{

  GPIO_InitTypeDef GPIO_InitStruct;

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOC_CLK_ENABLE();
  __HAL_RCC_GPIOF_CLK_ENABLE();
  __HAL_RCC_GPIOA_CLK_ENABLE();
  __HAL_RCC_GPIOB_CLK_ENABLE();

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOC, EOA_Pin|ATTACK_GATE_Pin|EOR_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOF, RELEASE_GATE_Pin|A_LED_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pin Output Level */
  HAL_GPIO_WritePin(GPIOB, C_LED_Pin|D_LED_Pin|B_LED_Pin|S_H_A_Pin 
                          |S_H_B_Pin, GPIO_PIN_RESET);

  /*Configure GPIO pins : EOA_Pin ATTACK_GATE_Pin EOR_Pin */
  GPIO_InitStruct.Pin = EOA_Pin|ATTACK_GATE_Pin|EOR_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

  /*Configure GPIO pins : RELEASE_GATE_Pin A_LED_Pin */
  GPIO_InitStruct.Pin = RELEASE_GATE_Pin|A_LED_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOF, &GPIO_InitStruct);

  /*Configure GPIO pins : C_LED_Pin D_LED_Pin B_LED_Pin S_H_A_Pin 
                           S_H_B_Pin */
  GPIO_InitStruct.Pin = C_LED_Pin|D_LED_Pin|B_LED_Pin|S_H_A_Pin 
                          |S_H_B_Pin;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);

  /*Configure GPIO pin : PA12 */
  GPIO_InitStruct.Pin = GPIO_PIN_12;
  GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

  /* EXTI interrupt init*/
  HAL_NVIC_SetPriority(EXTI15_10_IRQn, 1, 0);
  HAL_NVIC_EnableIRQ(EXTI15_10_IRQn);

}

/* USER CODE BEGIN 4 */




void ReadPins(void){
	pindownlastcycle = modechanged;

	    if (MyTKeys[3].p_Data->StateId == TSL_STATEID_DETECT) {
	    	modeflag = 1;
	    	modechanged = 1;
	    	ClearRGB();
	    	ShowMode(speed);
	    }
	    else {
	    	if (modeflag == 1) {modechanged = 0;}
	    }

	    if (MyTKeys[2].p_Data->StateId == TSL_STATEID_DETECT) {
	    	modeflag = 2;
	    	modechanged = 1;
	    	ClearRGB();
	    	ShowMode(trigMode);
	    }
	    else {
	    	if (modeflag == 2) {modechanged = 0;}
	    }


	    if (MyTKeys[1].p_Data->StateId == TSL_STATEID_DETECT) {
	    	modeflag = 3;
	    	modechanged = 1;
	    	ClearRGB();
	    	ShowMode(loop);
	    }
	    else {
	    	if (modeflag == 3) {modechanged = 0;}
	    }


	    if (MyTKeys[4].p_Data->StateId == TSL_STATEID_DETECT) {
	    	modeflag = 4;
	    	modechanged = 1;
	    	ClearRGB();
	    	ShowMode(sampleHoldMode);
	    }
	    else {
	    	if (modeflag == 4) {modechanged = 0;}
	    }

	    if (MyTKeys[5].p_Data->StateId == TSL_STATEID_DETECT) {
	    	modeflag = 5;
	    	modechanged = 1;
	    	ClearRGB();
	    	ShowMode(familyIndicator);
	    }
	    else {
	    	if (modeflag == 5) {modechanged = 0;}
	    }

	    if (MyTKeys[0].p_Data->StateId == TSL_STATEID_DETECT) {
	    	modeflag = 6;
	    	modechanged = 1;
	    	ClearRGB();
	    	ShowMode(familyIndicator);
	    }
	    else {
	    	if (modeflag == 6) {modechanged = 0;}
	    }

}

void ChangeMode(int mode) {
		if (mode == 1) {
			speed = (speed + 1) % 2;
		}
		if (mode == 2) {
			trigMode = (trigMode + 1) % 5;
		}
		if (mode == 3) {
			loop = (loop + 1) % 2;
		}
		if (mode == 4) {
			sampleHoldMode = (sampleHoldMode + 1) % 6;
		}
		if (mode == 5) {
			familyIndicator = (familyIndicator + 1) % 8;
			span = familyArray[familyIndicator].tableLength << 16;
			spanx2 = familyArray[familyIndicator].tableLength << 17;
		}
		if (mode == 6) {
			familyIndicator = (familyIndicator - 1);
			if (familyIndicator < 0) {
				familyIndicator = 7;
				span = familyArray[familyIndicator].tableLength << 16;
				spanx2 = familyArray[familyIndicator].tableLength << 17;
			}
		}
}

void ShowMode(uint8_t currentmode) {
	if (currentmode == 1) {
		HAL_GPIO_WritePin(GPIOF, GPIO_PIN_1, GPIO_PIN_SET);
		return;
	}
	if (currentmode == 2) {
		HAL_GPIO_WritePin(GPIOF, GPIO_PIN_1, GPIO_PIN_SET);
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_5, GPIO_PIN_SET);
		return;
	}
	if (currentmode == 3) {
		HAL_GPIO_WritePin(GPIOF, GPIO_PIN_1, GPIO_PIN_SET);
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_5, GPIO_PIN_SET);
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_10, GPIO_PIN_SET);
		return;

	}
	if (currentmode == 4) {
		HAL_GPIO_WritePin(GPIOF, GPIO_PIN_1, GPIO_PIN_SET);
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_5, GPIO_PIN_SET);
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_10, GPIO_PIN_SET);
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_15, GPIO_PIN_SET);
		return;

	}
	if (currentmode == 5) {
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_5, GPIO_PIN_SET);
		return;

	}
	if (currentmode == 6) {
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_10, GPIO_PIN_SET);
		return;

	}
	if (currentmode == 7) {
		HAL_GPIO_WritePin(GPIOB, GPIO_PIN_15, GPIO_PIN_SET);
		return;

	}
}

void ClearRGB(void) {
	 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_1, 0);
	 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_2, 0);
	 __HAL_TIM_SET_COMPARE(&htim1, TIM_CHANNEL_3, 0);
}
void ClearLEDs(void) {
	HAL_GPIO_WritePin(GPIOF, GPIO_PIN_1, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(GPIOB, GPIO_PIN_5, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(GPIOB, GPIO_PIN_10, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(GPIOB, GPIO_PIN_15, GPIO_PIN_RESET);
}







/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @param  None
  * @retval None
  */
void _Error_Handler(char * file, int line)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  while(1) 
  {
  }
  /* USER CODE END Error_Handler_Debug */ 
}

#ifdef USE_FULL_ASSERT

/**
   * @brief Reports the name of the source file and the source line number
   * where the assert_param error has occurred.
   * @param file: pointer to the source file name
   * @param line: assert_param error line source number
   * @retval None
   */
void assert_failed(uint8_t* file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
    ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */

}

#endif

/**
  * @}
  */ 

/**
  * @}
*/ 

/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
